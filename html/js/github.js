let github_owner="MakerbaseMoon",github_repo="SpiderBot",github_list=[],github_latest_version=null,ota_data={url:"",tag_name:null,body:null};function get_github_list_releases(){try{let t=new XMLHttpRequest;t.open("GET",`https://api.github.com/repos/${github_owner}/${github_repo}/releases`,!0),t.setRequestHeader("Accept","application/vnd.github+json"),t.send(),t.addEventListener("load",()=>{github_list=[];let e=JSON.parse(t.responseText);try{for(let t=0;t<e.length;t++){let a={tag_name:e[t].tag_name,body:e[t].body};github_list.push(a)}console.log(github_list)}catch(t){console.log(t)}})}catch(t){}}function get_github_latest_release(){try{let t=new XMLHttpRequest;t.open("GET",`https://api.github.com/repos/${github_owner}/${github_repo}/releases/latest`,!0),t.setRequestHeader("Accept","application/vnd.github+json"),t.send(),t.addEventListener("load",()=>{let e=JSON.parse(t.responseText);for(console.log(e),github_latest_version=e.tag_name,ota_data.tag_name=e.tag_name,ota_data.body=e.body,ota_data.url=`https://github.com/${github_owner}/${github_repo}/releases/download/${ota_data.tag_name}/firmware.bin`;!my_esp_data.isOK;);show_ota_data(),my_esp_data.version>github_latest_version?upgrade.style.color="orange":my_esp_data.version<github_latest_version&&(upgrade.style.color="red")})}catch(t){}}function get_github_release_by_id({release_id:t}){try{let e=new XMLHttpRequest;e.open("GET",`https://api.github.com/repos/${github_owner}/${github_repo}/releases/${{release_id:t}}`,!0),e.setRequestHeader("Accept","application/vnd.github+json"),e.send(),e.addEventListener("load",()=>{let t=JSON.parse(e.responseText);console.log(t),ota_data.tag_name=t.tag_name,ota_data.body=t.body,ota_data.url=`https://github.com/${github_owner}/${github_repo}/releases/download/${ota_data.tag_name}/firmware.bin`,show_ota_data()})}catch(t){}}function get_github_release_by_tag_name(t){try{let e=new XMLHttpRequest;e.open("GET",`https://api.github.com/repos/${github_owner}/${github_repo}/releases/tags/${t}`,!0),e.setRequestHeader("Accept","application/vnd.github+json"),e.send(),e.addEventListener("load",()=>{let t=JSON.parse(e.responseText);console.log(t),ota_data.tag_name=t.tag_name,ota_data.body=t.body,ota_data.url=`https://github.com/${github_owner}/${github_repo}/releases/download/${ota_data.tag_name}/firmware.bin`,show_ota_data()})}catch(t){}}function icon_click(){setting.addEventListener("click",()=>{"none"===setting_form.style.display?(setting_form.style.display="block",upgrade_form.style.display="none"):(setting_form.style.display="none",upgrade_form.style.display="none")}),upgrade.addEventListener("click",()=>{"none"===upgrade_form.style.display?(upgrade_form.style.display="block",setting_form.style.display="none"):(upgrade_form.style.display="none",setting_form.style.display="none")})}function get_github_ota(t){try{let e=new XMLHttpRequest;e.open("POST",`${window.location.origin}/ota/update`,!0),e.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),e.send(`url=${t}`),e.addEventListener("load",()=>{console.log(e.responseText)})}catch(t){}}function show_ota_data(){ota_update_btn.classList=[],ota_update_btn.classList.add("btn"),my_esp_data.version!=ota_data.tag_name?(ota_update_btn.disabled=!1,my_esp_data.version>ota_data.tag_name?(esp_version_tag.style.color="purple",version_tag.style.color="orange",ota_update_btn.classList.add("btn-outline-warning"),ota_update_btn.innerText=`Downgrade ${ota_data.tag_name} (更新舊版本 ${ota_data.tag_name})`):(esp_version_tag.style.color="gray",version_tag.style.color="red",ota_update_btn.classList.add("btn-outline-danger"),ota_update_btn.innerText=`Update ${ota_data.tag_name} (更新版本 ${ota_data.tag_name})`)):(esp_version_tag.style.color="black",version_tag.style.color="gray",ota_update_btn.disabled=!0,ota_update_btn.classList.add("btn-outline-secondary"),ota_update_btn.innerText="NO Update (相同版本)"),version_tag.innerText="GitHub Version: "+ota_data.tag_name,version_body.innerHTML=ota_data.body,(github_latest_version=ota_data.tag_name)&&(version_tag.innerText=`GitHub Version: ${ota_data.tag_name} (latest)`)}ota_update_btn.addEventListener("click",()=>{""!=ota_data.url&&(get_github_ota(ota_data.url),ota_update_btn.disabled=!0)});